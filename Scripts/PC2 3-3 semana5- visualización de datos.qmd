---
title: "PRACTICA N5"
author: "GRUPO 06"
format: html
editor: visual
---

# Paquetes para visualizar datos

Primero instalamos los paquetes y despues los cargamos de la libreria

```{r}
install.packages("gridExtra")
install.packages("GGally")
install.packages("forcats")
```

```{r}
install.packages("rio")
install.packages("here")
install.packages("tidyverse")
```

```{r}
library(rio)
library(here)
library(tidyverse)
library(gridExtra) ## Para múltiple gráficos en una sola página
library(GGally) ## Para gráficos de correlación
library(forcats)
```

# Cargando los datos

Al cargar los datos visualizamos que el *dataset* contiene datos de 218 pacientes con conocimientos, actitudes y practicas de cáncer cervical. El *dataset* incluye 18 variables entre demográficas, clínicas y variables patológicas.

```{r}
data_cancercervical <- import(here("data","conoc_actit_factor_cancer_cervical.csv"))
```

## Examinamos los datos

`str()` es la función para ver la estructura de los datos.

```{r}
str(data_cancercervical)
```

## Conversión de caracteres a factor (categóricos) usando la función `mutate_if()`

Las variables categóricas (ej. Estadio T) han sido importadas como caracteres. Necesitamos transformalo a factores. En RStudio, factores es el tipo de dato para trabajar con variables categóricas.

```{r}
data_cancer <- data_cancercervical |> 
  mutate_if(is.character, as.factor)
str(data_cancer)
```

# Visualizando distribución de datos

# 1. Visualizando datos categóricos

Gráficos de barra Los gráficos de barra son adecuados para mostrar frecuencias de variables categóricas.

```{r}
data_cancer |>  
  ggplot(aes(x = e_marital)) +
  geom_bar()
data_cancer |>  
  ggplot(aes(x = met_anticoncep)) +
  geom_bar()
```

Aquí, añadimos la función `fct_infreq()` de paquete forcats para ordenar (en orden decreciente) las barras del conteo, por estado marital.

```{r}
data_cancer |>  
  ggplot(aes(x = fct_infreq(e_marital))) + geom_bar()
data_cancer |>  
  ggplot(aes(x = fct_infreq(met_anticoncep))) + geom_bar()
```

Con la función `labs()` podemos añadir nombres a los ejes del gráficos.

```{r}
data_cancer |>  
  ggplot(aes(x = fct_infreq(e_marital))) + geom_bar() +
  labs(y = "Frecuencia", x = "Estado Marital")
data_cancer |>  
  ggplot(aes(x = fct_infreq(met_anticoncep))) + geom_bar() +
  labs(y = "Frecuencia", x = "Metodos anticonceptivos")
```

Para el gráfico de barra podemos usar frecuencias relativas. Por ejemplo, un gráfico de barras que muestre proporciones. Aquí es necesario calcular las proporciones. Nota que seguida a `y =` se muestra el cálculo para convertir los conteos a proporciones.

```{r}
data_cancer |>  
  ggplot(aes(x = e_marital, y = ..count../sum(after_stat(count)))) +
  geom_bar() +
  labs(y = "Frecuencia", x = "Estado Marital")
data_cancer |>  
  ggplot(aes(x = met_anticoncep, y = ..count../sum(after_stat(count)))) +
  geom_bar() +
  labs(y = "Frecuencia", x = "Metodo anticonceptivo")
```

# 2. Visualizando Datos Numéricos

## 2.1. Con histogramas

Para visualizar conteos. Nota que aquí, la variable `edad_relacion_sexual` es numérica y la función para producir un histograma es `geom_histogram()`

```{r}
data_cancer |>  
  ggplot(aes(x = edad_relacion_sexual)) + geom_histogram() + labs(y = "Frecuencia", x = "Edad de inicio de relacion sexual")
```

```{r}
data_cancer |>  
  ggplot(aes(x = num_hijos)) + geom_histogram() + labs(y = "Frecuencia", x = "Numero de hijos")
```

Un histograma de proporciones. Aquí `..density..` es la estimación de densidad que reemplaza al conteo crudo. Toda el area del gráfico de densidad suma 1.

```{r}
data_cancer  |>  
  ggplot(aes(x = edad_relacion_sexual)) + geom_histogram(aes(y = ..density..)) +  labs(y = "Density", x = "Edad de inicio de relacion sexual")
```

```{r}
data_cancer  |>  
  ggplot(aes(x = num_hijos)) + geom_histogram(aes(y = ..density..)) +  labs(y = "Density", x = "Numero de hijos")
```

A veces, puede ser util visualizar gráficos de lado a lado. Aquí dos histogramas lado a lado usando la función `grid.arrange()`

```{r}
hist_1 = data_cancer |> ggplot(aes(x = edad_relacion_sexual)) +
  geom_histogram() +
  labs(y = "Frecuencia", x = "Edad de inicio de relacion sexual")

hist_2 = data_cancer  |>  
  ggplot(aes(x = edad_relacion_sexual)) +
  geom_histogram(aes(y = ..density..)) +
  labs(y = "Density", x = "Edad de inicio de relacion sexual")
```

```{r}
grid.arrange(hist_1, hist_2, ncol = 2)
```

Conteo con un número de barras distinto

Podemos cambiar los intervalos para la generación del histograma usando el argumento bins dentro de la función `geom_histogram()`

```{r}
data_cancer |>  
  ggplot(aes(x = edad_relacion_sexual)) +
  geom_histogram(bins = 10) +
  labs(y = "Frecuencia", x = "Edad de inicio de relacion sexual")
```

Modificando los colores de las barras del histograma.

```{r}
data_cancer |>  
  ggplot(aes(x = edad_relacion_sexual)) +
  geom_histogram(
    color = "white", ## Color de las barras
    fill = "cornflowerblue" ## Color de las barras
    ) + 
  labs(y = "Frecuencia", 
       x = "Edad de inicio de relacion sexual")
```

Modificando color en gráficos de barras. Nota que aquí, usamos el argumento fill para colorear las barras pertenecientes a las categorías.

```{r}
data_cancer |>  
  ggplot(aes(x = fct_infreq(e_marital), fill = e_marital)) +
  geom_bar() +
  labs(y = "Frecuencia", x = "Estado Marital")
```

## 2.2. Con Boxplots (gráfico de cajas y bigotes)

Para mostrar datos de una variable en un gráfico de cajas y bigotes usamos la función `geom_boxplot()`

```{r}
data_cancer |> 
  ggplot(aes(y = parejas_sex)) + ## Cambia y por x para invertir el gráfico
  geom_boxplot() +
  theme(axis.text.x  = element_blank(),
        axis.ticks.x = element_blank()) +
  labs(y = "Parejas sexuales")
```

La función nativa de R, `boxplot()`, permite realizar el mismo gráfico.

```{r}
box_pareja_sexuales = boxplot(data_cancer$parejas_sex,
                         ylab = "Parejas sexuales",
                         horizontal = TRUE, ## Cambia la dirección del gráfico
                         col = "salmon") ## Añadimos color
  
```

# 3. Visualizando variables categóricas *versus* categóricas

```{r}
data_cancer |> 
  ggplot(aes(x = conocimiento, fill = practica)) +
  geom_bar(position = "dodge") + ## Sin este argumento, las barras estarán una sobre otras
  labs(y = "Frecuencia",  
       x = "Conocimiento",
       fill = "Practica")
```

Qué esta mal con esto?

```{r}
data_cancer |>   
  group_by(conocimiento, practica)  |>  
  count() |>   
  # Compute proportions within grade
  # n is the default variable created by count()
  group_by(conocimiento) |>   
  mutate(Proportion = n/sum(n))  |> 
  ggplot(aes(x = conocimiento, y = Proportion, fill = practica)) +
  geom_bar(position = 'dodge', stat = 'identity') +
  labs(y = "Proportion",
       x = "Conocimiento",
       fill = "Practica")
```

```{r}
addmargins(prop.table(
  table(data_cancer$conocimiento, data_cancer$practica), 
  margin = 2), 1)
```

# 4. Visualizando distribución de variables continuas *versus* categóricas

## 4.1. Gráficos de barras

```{r}
data_cancer |> 
  filter(!is.na(parejas_sex) & !is.na(antec_ets)) |> 
  group_by(parejas_sex, antec_ets) |> 
  summarise(n = n(),
            promedio = mean(num_hijos, na.rm = T),
            de = sd(num_hijos, na.rm = T)) |> 
  ggplot(aes(x = parejas_sex, y = promedio, fill = antec_ets)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_errorbar(aes(ymin = promedio - de, ymax = promedio + de),
                width = 0.5, size = 0.75, position = position_dodge(0.9)) +
  labs(y = "Numero de hijos", fill = "Antecedentes de ETS", x = "Parejas sexuales")
```

## 4.1. Boxplots lado a lado

```{r}
data_cancer |>  
  filter(!is.na(met_anticoncep)& !is.na(parejas_sex))  |> 
  ggplot(aes(y = parejas_sex, x = met_anticoncep)) +
  geom_boxplot() +
  labs(y = "Parejas sexuales", x = "Metodo anticonceptivo")
```

```{r}
data_cancer |>  
  filter(!is.na(parejas_sex)& !is.na(met_anticoncep) & !is.na(antec_ets))  |> 
  ggplot(aes(y = parejas_sex, x = met_anticoncep, fill = antec_ets)) +
  geom_boxplot() +
  labs(y = "Parejas sexuales", x = "Metodos anticonceptivos")
```

```{r}
data_cancer |>  
  filter(!is.na(num_hijos)& !is.na(n_educacion) & !is.na(met_anticoncep))  |> 
  ggplot(aes(y = num_hijos, x = met_anticoncep, fill = n_educacion)) +
  geom_boxplot() +
  labs(y = "Numero de hijos", x = "Metodos anticonceptivos")
```

## 4.3. Filas de histogramas

```{r}
data_cancer  |>  
  filter(!is.na(practica) & !is.na(actitud) & !is.na(edad)) |>
  group_by(conocimiento) |>  
  ggplot(aes(x = edad)) +
  geom_histogram(aes(y = ..density..), bins = 20,
                 color = "black", fill = "white") +
  labs(x = "Edad", y = "Conocimiento") +
  facet_wrap(~conocimiento, nrow = 4) +
  ggtitle("Edad")
```

# 5. Visualización para variables continuas versus continuas

Usamos la función geom_point para generar gráficos de dispersión y visualizar la relación de dos varaibles numéricas

```{r}
data_cancer |> 
  ggplot(aes(x = edad_relacion_sexual, y = num_hijos)) +
  geom_point() +
  labs(x = "Edad de relacion sexual", y = "Numero de hijos")
```

La función geom_smoth añade una línea de regresión al gráfico. "lm" es para linear model

```{r}
data_cancer |> 
  ggplot(aes(x = edad_relacion_sexual, y = num_hijos)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(x = "Edad de relacion sexual", y = "Numero de hijos")
```

Aquí, función geom_smooth() añade una línea de tendencia suavizada al gráfico.

```{r}
data_cancer |> 
  ggplot(aes(x = edad_relacion_sexual, y = num_hijos)) +
  geom_point() +
  geom_smooth(stat = "smooth", se = TRUE) +
  labs(x = "Edad de relacion sexual", y = "Numero de hijos")
```

Finalmente, la función `ggpairs()` permite visualizar multiple variables numerica a la vez. Aquí, combinamos la funciónm select() (para seleccionar las variables numéricas) y ggpairs, para generar el gráfico y los coeficientes de correlación.

```{r}
data_cancer |>  
  select(num_hijos, edad_relacion_sexual, parejas_sex ) %>% 
  ggpairs(columnLabels = c("Numero de hijos", "Edad de relacion Sexual", "Numero de parejas sexuales"))
```

# 6. Exportando figuras

```{r}
ggsave(
  "Graficos_de_cancer_cervical.png",
  width = 7, # Ancho
  height = 4, # Alto
  dpi = 300 # resolución
) 
```
